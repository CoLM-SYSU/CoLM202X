# Script/Code for river map parameters

## Essential Scripts
### s01-channel_params.sh

 Estimating channel parameters (depth, width) by empirical equations of annual discharge
 Please execute this shell script in $CaMa-Flood/map/$MAPNAME directory
 ~~~
 % cd $MAPNAME
 % ../s01-channel_params.sh
~~~

If you follow the default setting of  CaMa-Flood v4, channel cross section parameters (channel width rivwth.bin and channel depth rivhgt.bin) are  generated by the power-law equations of annual mean river discharge. The parameter of the power-law equation (width: WC, WP, WO, Wmin; depth: HC, HP, HO, HMIN) should be specified in the shell script.

1. First, annual mean discharge is calculated from runoff climatology by calc_outclm.F90.

2. Then, rivwth.bin & rivhgt.bin are calculated by calc_rivwth.F90.

3. In the defauled setting of CaMa-Flood v4, channel width parameter is given as the fusion of 
- satellite-observed river width GWD-LR  (width.bin) and
- power-law estimation of river width (rivwth.bin).
The fused width parameter rivwth_gwdlr.bin is generared by set_gwdlr.F90.

4. In addition, the parameters for bifurcation channels should be fixed by set_fifparam.F90.
The number of bifurcation channel layers should be specified in the script.

### s02-generate_inpmat.sh

This script is for generating the input matrix (look up table for input runoff interpolation).
One input matrix should be prepared for one combination of the CaMa-Flood river map and the input runoff data. (if grid coordination of runoff data is different from default, a new input matrix should be prepared)

The input matrix file names and the grid coordination of the input runoff data should be specified. Also, the precision of interpolation (1min, 30sec, 15sec, etc) should be specified in the script.

The input matrix file is generated by generate_inpmat.F90

### Other helpful codes.

#### calc_prmwat.F90
To calculate the parmanent water area in each unit-catchment, using high-resolution water mask (hires/rivwth.bin).
Usage:
~~~
% calc_prmwat [1min, 30sec, 15sec, 3sec]
~~~
The high-resolution topography map should be prepared in the map directory. (default 1min only)
The parmanent water area file is prmwat.bin (in m2).

#### get_rivinfo.F90
Topographic information on the specific location on the river network is shown.
This code is helpful to find a specific site (e.g. gauging stations, confluence, etc), and aquire its grid coordination (IX,IY)

USAGE(1) Input IX  and IY :    (Use Fortran IX,IY coordinate)
~~~
./get_rivinfo xy $IX  $IY
~~~

USAGE(2) Input lat and lon: 
~~~
./get_rivinfo latlon $LAT $LON'
~~~

#### get_subbasin.F90
The river network is descretized to the sub-basins, using drainage area threshold. The tributary larger than the threshold area is descretized.

USAGE: Input Uparea Threshold [km2] :  
~~~
./get_subbasin $UPA_THRS
~~~
Output: subbsn.bin

#### get_upbasin.F90
This code calculates the upstream drainage basin of a specific location on the river network map.

USAGE: Input IX, IY, OutFile   
~~~
./get_upbasin $IX  $IY $OUTFILE
~~~
Output: upbasin.bin (upstream basin of [IX,IY])


#### get_vecmap.F90
This code generates the data to visualize vector-like river map, output in text format.
Data for a specific domain (WEST, EAST, SOUTH, NORTH) is generated.

USAGE Input WEST, EAST, SOUTH, NORTH
~~~
./get_vecmap $WEST $EAST $SOUTH $NORTH
~~~
Output: upbasin.bin (upstream basin of [IX,IY])

